{% extends 'accounting/base.html' %}
{% load static %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-4 no-print">
        <a href="{% url 'invoice_list' %}" class="btn btn-outline-secondary">&laquo; Back to List</a>
        <div>
            <button onclick="window.print()" class="btn btn-secondary me-2">üñ®Ô∏è Print</button>
            
            {% if invoice.status == 'Draft' %}
                <form action="{% url 'change_invoice_status' invoice.id 'Sent' %}" method="POST" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary">Mark as Sent</button>
                </form>
            {% endif %}
            
            {% if invoice.status != 'Paid' and invoice.status != 'Void' %}
                <form action="{% url 'change_invoice_status' invoice.id 'Void' %}" method="POST" class="d-inline" onsubmit="return confirm('Void this invoice?');">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger ms-2">Void</button>
                </form>
            {% endif %}
        </div>
    </div>

    {% if invoice.internal_notes %}
    <div class="alert alert-warning no-print mb-4">
        <strong>üîí Internal Notes:</strong> {{ invoice.internal_notes }}
    </div>
    {% endif %}

    <div class="card shadow-lg border-0">
        <div class="card-body p-5">
            
            <div class="row mb-5">
                <div class="col-6">
                    <img src="{% static 'accounting/images/logo.png' %}" alt="Logo" style="max-width: 180px;" class="mb-3">
                    <h4 class="fw-bold text-primary">Riska's Finance</h4>
                    <p class="text-muted mb-0">614 Crawford Ave</p>
                    <p class="text-muted mb-0">Dixon, IL</p>
                    <p class="text-muted">Email: Riskas.finances@gmail.com</p>
                </div>
                <div class="col-6 text-end">
                    <h1 class="display-4 fw-bold text-uppercase text-secondary">INVOICE</h1>
                    <h3 class="text-dark">{{ invoice.invoice_number }}</h3>
                    
                    <div class="mt-3">
                        <p class="mb-0">Date: <strong>{{ invoice.invoice_date }}</strong></p>
                        <p class="mb-0">Terms: <strong>{{ invoice.payment_terms }}</strong></p>
                        <p class="mb-0">Due Date: <strong class="text-danger">{{ invoice.due_date }}</strong></p>
                    </div>

                    <div class="mt-2">
                        <span class="badge {% if invoice.status == 'Paid' %}bg-success{% else %}bg-warning text-dark{% endif %} fs-6">
                            {{ invoice.status }}
                        </span>
                    </div>
                </div>
            </div>

            <hr class="my-4">

            <div class="row mb-5">
                <div class="col-6">
                    <h6 class="text-uppercase text-muted fw-bold">Bill To:</h6>
                    <h4 class="mb-1">{{ invoice.customer.name }}</h4>
                    <p class="mb-0">{{ invoice.customer.address|linebreaksbr }}</p>
                    <p class="text-muted mt-1">{{ invoice.customer.email }}</p>
                </div>
            </div>

            <div class="table-responsive mb-4">
                <table class="table table-striped table-hover border">
                    <thead class="table-dark">
                        <tr>
                            <th style="width: 50%">Description</th>
                            <th class="text-center" style="width: 15%">Qty</th>
                            <th class="text-end" style="width: 15%">Rate</th>
                            <th class="text-end" style="width: 20%">Amount</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for line in invoice.lines.all %}
                        <tr>
                            <td class="fw-bold">{{ line.description }}</td>
                            <td class="text-center">{{ line.quantity }}</td>
                            <td class="text-end">${{ line.unit_price|floatformat:2 }}</td>
                            <td class="text-end fw-bold">${{ line.line_total|floatformat:2 }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <div class="row mt-4">
                <div class="col-7">
                    {% if invoice.customer_message %}
                        <div class="p-3 bg-light rounded border">
                            <h6 class="fw-bold text-muted">Message to Customer:</h6>
                            <p class="mb-0 small">{{ invoice.customer_message }}</p>
                        </div>
                    {% endif %}
                    <p class="text-muted mt-3 small"><em>{{ invoice.description }}</em></p>
                </div>
                <div class="col-5">
                    <table class="table table-borderless">
                        <tr class="border-top border-bottom border-2 border-dark table-light">
                            <td class="fs-3 fw-bold text-end">Total Due:</td>
                            <td class="fs-3 fw-bold text-end text-primary">${{ invoice.total_amount|floatformat:2 }}</td>
                        </tr>
                    </table>
                </div>
            </div>
            
            <div class="row mt-5 pt-5 no-screen d-none d-print-block">
                <div class="col-12 text-center text-muted small">
                    <p>Thank you for your business!</p>
                    <p>Riska's Finance ‚Ä¢ 614 Crawford Ave, Dixon, IL</p>
                </div>
            </div>

        </div>
    </div>

    <style>
        @media print {
            .no-print { display: none !important; }
            .d-print-block { display: block !important; }
            body { background-color: white; }
            .card { box-shadow: none !important; border: none !important; }
            .container { max-width: 100%; padding: 0; margin: 0; }
        }
    </style>
{% endblock %}