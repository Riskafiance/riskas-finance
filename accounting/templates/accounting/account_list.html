{% extends 'accounting/base.html' %}
{% load humanize %} {% block content %}
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>Chart of Accounts</h1>
    </div>

    <div class="alert alert-light border shadow-sm mb-4">
        <h5 class="alert-heading text-primary"><i class="bi bi-journal-bookmark-fill"></i> Understanding Your Accounts</h5>
        <hr>
        <p class="mb-3">
            The Chart of Accounts is the complete list of every bucket where your money is categorized. 
            It is organized into five major types:
        </p>
        <div class="row g-3">
            <div class="col-md-2">
                <div class="p-2 bg-white border rounded h-100">
                    <strong class="text-success d-block mb-1">1. Assets</strong>
                    <small class="text-muted">What you own (Cash, Inventory, Equipment).</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="p-2 bg-white border rounded h-100">
                    <strong class="text-danger d-block mb-1">2. Liabilities</strong>
                    <small class="text-muted">What you owe (Loans, Credit Cards, Accounts Payable).</small>
                </div>
            </div>
            <div class="col-md-2">
                <div class="p-2 bg-white border rounded h-100">
                    <strong class="text-primary d-block mb-1">3. Equity</strong>
                    <small class="text-muted">The owner's stake (Investments, Retained Earnings).</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="p-2 bg-white border rounded h-100">
                    <strong class="text-info d-block mb-1">4. Revenue</strong>
                    <small class="text-muted">Money earned from selling goods or services (Sales, Interest Income).</small>
                </div>
            </div>
            <div class="col-md-3">
                <div class="p-2 bg-white border rounded h-100">
                    <strong class="text-warning d-block mb-1">5. Expenses</strong>
                    <small class="text-muted">Cost of doing business (Rent, Utilities, Wages).</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-3 align-items-center">
        <div class="col-md-6">
            <a href="{% url 'add_account' %}" class="btn btn-primary">
                <i class="bi bi-plus-lg"></i> Add New Account
            </a>
            <a href="{% url 'recalculate_balances' %}" class="btn btn-warning ms-2" onclick="return confirm('This will recalculate all account balances based on the entire transaction history. This cannot be undone. Continue?');">
                <i class="bi bi-arrow-clockwise"></i> Recalculate Balances
            </a>
        </div>
        
        <div class="col-md-6">
            <form method="GET" class="d-flex">
                <input type="text" name="search" class="form-control me-2" placeholder="Search by Number or Name..." value="{{ search_query }}">
                <button type="submit" class="btn btn-secondary"><i class="bi bi-search"></i></button>
                {% if search_query %}
                    <a href="{% url 'account_list' %}" class="btn btn-outline-danger ms-2">Clear</a>
                {% endif %}
            </form>
        </div>
    </div>
    
    <div class="card shadow-sm border-0">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-striped table-hover mb-0 align-middle">
                    <thead class="table-dark">
                        <tr>
                            <th>Account Number</th>
                            <th>Account Name</th>
                            <th>Type</th>
                            <th>Normal Balance</th>
                            <th class="text-end">Current Balance</th> <th class="text-end">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for account in accounts %}
                        <tr class="{% if not account.is_active %}text-muted fst-italic{% endif %}">
                            <td class="fw-bold font-monospace">{{ account.account_number }}</td>
                            <td>
                                <a href="{% url 'account_ledger' account.id %}" class="text-decoration-none {% if not account.is_active %}text-muted{% endif %}">
                                    {{ account.account_name }}
                                </a>
                            </td>
                            <td>
                                <span class="badge 
                                    {% if account.account_type == 'Asset' %}bg-success
                                    {% elif account.account_type == 'Liability' %}bg-danger
                                    {% elif account.account_type == 'Equity' %}bg-primary
                                    {% elif account.account_type == 'Revenue' %}bg-info text-dark
                                    {% else %}bg-warning text-dark{% endif %}">
                                    {{ account.account_type }}
                                </span>
                            </td>
                            <td>{{ account.normal_balance }}</td>
                            
                            <td class="text-end fw-bold font-monospace">
                                ${{ account.current_balance|floatformat:2|intcomma }}
                            </td>
                            
                            <td class="text-end">
                                <div class="btn-group" role="group">
                                    <a href="{% url 'edit_account' account.id %}" class="btn btn-sm btn-outline-primary">Edit</a>
                                    
                                    <form action="{% url 'toggle_account_activity' account.id %}" method="POST" class="d-inline">
                                        {% csrf_token %}
                                        {% if account.is_active %}
                                            <button type="submit" class="btn btn-outline-warning btn-sm" title="Deactivate">
                                                <i class="bi bi-eye-slash"></i>
                                            </button>
                                        {% else %}
                                            <button type="submit" class="btn btn-outline-success btn-sm" title="Activate">
                                                <i class="bi bi-eye"></i>
                                            </button>
                                        {% endif %}
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" class="text-center py-4 text-muted">No accounts found matching your search.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
{% endblock %}